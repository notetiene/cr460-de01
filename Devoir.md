Devoir 1 pour le cours CR460
============================

<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
**Table of Contents**

- [Devoir 1 pour le cours CR460](#devoir-1-pour-le-cours-cr460)
  - [√ânonc√©](#√©nonc√©)
  - [Pr√©requis](#pr√©requis)
    - [Installation de jq](#installation-de-jq)
  - [Installation et configuration de VS Code](#installation-et-configuration-de-vs-code)
  - [Installation et configuration de GitHub Desktop (et Git)](#installation-et-configuration-de-github-desktop-et-git)
    - [Configuration de GitHub Desktop](#configuration-de-github-desktop)
    - [GitHub CLI](#github-cli)
      - [Installation de GitHub CLI](#installation-de-github-cli)
      - [Connexion de GitHub CLI (`gh`) au compte GitHub](#connexion-de-github-cli-gh-au-compte-github)
    - [Cr√©ation d‚Äôun d√©p√¥t local Git](#cr√©ation-dun-d√©p√¥t-local-git)
      - [Ajout du premier commit](#ajout-du-premier-commit)
    - [Cr√©ation d‚Äôun d√©p√¥t distant avec GitHub](#cr√©ation-dun-d√©p√¥t-distant-avec-github)
    - [Mise √† jour du d√©p√¥t suivi (_remote_)](#mise-√†-jour-du-d√©p√¥t-suivi-_remote_)
  - [Terraform CLI et Terraform cloud](#terraform-cli-et-terraform-cloud)
    - [Installation de Terraform CLI](#installation-de-terraform-cli)
    - [Test de Terraform CLI](#test-de-terraform-cli)
    - [Activation de Terraform cloud](#activation-de-terraform-cloud)
    - [Cr√©ation d‚Äôune nouvelle organisation Terraform Cloud](#cr√©ation-dune-nouvelle-organisation-terraform-cloud)
    - [Cr√©ation d‚Äôun nouveau projet Terraform Cloud](#cr√©ation-dun-nouveau-projet-terraform-cloud)
    - [Cr√©ation d‚Äôun espace de travail Terraform (_workspace_)](#cr√©ation-dun-espace-de-travail-terraform-_workspace_)
  - [Configuration du compte Microsoft Azure](#configuration-du-compte-microsoft-azure)
    - [Installation de Azure CLI](#installation-de-azure-cli)
    - [Connexion au compte Azure (utilitaire `az`)](#connexion-au-compte-azure-utilitaire-az)
    - [Cr√©ation du _service principal_](#cr√©ation-du-_service-principal_)

<!-- markdown-toc end -->

## √ânonc√©
![Diagramme de l‚Äô√©nonc√©](./docs/homework_diagram.png)

> **Mise en place d un pipeline CI/CD pour MS Azure**
> En se basant sur le diagramme ci-dessus , construire un pipeline CI/CD vers Microsoft Azure.

## Pr√©requis
Le playbook inclus a √©t√© con√ßu pour fonctionner sous [Ubuntu 22.04.3](https://releases.ubuntu.com/jammy/).  Il peut (th√©oriquement) fonctionner avec les distributions d√©riv√©es de Debian.  Cependant, prendre note que la pr√©sente installation [VS Code](https://code.visualstudio.com/) requiert l‚Äôutilisation de [snap](https://snapcraft.io/about).

### Installation de jq
> üìù **Note¬†:** Cette √©tape est n√©cessaire (ou utile) pour la cr√©ation automatique d‚Äôun _service principal_ en permettant d‚Äôextraire des donn√©es _JSON_.

Pour n‚Äôinstaller que l‚Äôutilitaire `jq`, ex√©cuter localement la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags jq
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [Installation de jq] **********************************************************************************************************************************************************************************
Lecture des listes de paquets‚Ä¶
Construction de l'arbre des d√©pendances‚Ä¶
Lecture des informations d'√©tat‚Ä¶
Les NOUVEAUX paquets suivants seront install√©s¬†:
  jq
0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.
Il est n√©cessaire de prendre 52.5 ko dans les archives.
Apr√®s cette op√©ration, 102 ko d'espace disque suppl√©mentaires seront utilis√©s.
R√©ception de¬†:1 http://gpl.savoirfairelinux.net/pub/mirrors/ubuntu jammy/main amd64 jq amd64 1.6-2.1ubuntu3 [52.5 kB]
52.5 ko r√©ceptionn√©s en 0s (476 ko/s)
S√©lection du paquet jq pr√©c√©demment d√©s√©lectionn√©.
(Lecture de la base de donn√©es... 
(Lecture de la base de donn√©es... 5%
(Lecture de la base de donn√©es... 10%
(Lecture de la base de donn√©es... 15%
(Lecture de la base de donn√©es... 20%
(Lecture de la base de donn√©es... 25%
(Lecture de la base de donn√©es... 30%
(Lecture de la base de donn√©es... 35%
(Lecture de la base de donn√©es... 40%
(Lecture de la base de donn√©es... 45%
(Lecture de la base de donn√©es... 50%
(Lecture de la base de donn√©es... 55%
(Lecture de la base de donn√©es... 60%
(Lecture de la base de donn√©es... 65%
(Lecture de la base de donn√©es... 70%
(Lecture de la base de donn√©es... 75%
(Lecture de la base de donn√©es... 80%
(Lecture de la base de donn√©es... 85%
(Lecture de la base de donn√©es... 90%
(Lecture de la base de donn√©es... 95%
(Lecture de la base de donn√©es... 100%
(Lecture de la base de donn√©es... 438132 fichiers et r√©pertoires d√©j√† install√©s.)
Pr√©paration du d√©paquetage de .../jq_1.6-2.1ubuntu3_amd64.deb ...
D√©paquetage de jq (1.6-2.1ubuntu3) ...
Param√©trage de jq (1.6-2.1ubuntu3) ...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†...
changed: [localhost] => {"cache_update_time": 1710052522, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Lecture des listes de paquets‚Ä¶\nConstruction de l'arbre des d√©pendances‚Ä¶\nLecture des informations d'√©tat‚Ä¶\nLes NOUVEAUX paquets suivants seront install√©s¬†:\n  jq\n0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.\nIl est n√©cessaire de prendre 52.5 ko dans les archives.\nApr√®s cette op√©ration, 102 ko d'espace disque suppl√©mentaires seront utilis√©s.\nR√©ception de¬†:1 http://gpl.savoirfairelinux.net/pub/mirrors/ubuntu jammy/main amd64 jq amd64 1.6-2.1ubuntu3 [52.5 kB]\n52.5 ko r√©ceptionn√©s en 0s (476 ko/s)\nS√©lection du paquet jq pr√©c√©demment d√©s√©lectionn√©.\r\n(Lecture de la base de donn√©es... \r(Lecture de la base de donn√©es... 5%\r(Lecture de la base de donn√©es... 10%\r(Lecture de la base de donn√©es... 15%\r(Lecture de la base de donn√©es... 20%\r(Lecture de la base de donn√©es... 25%\r(Lecture de la base de donn√©es... 30%\r(Lecture de la base de donn√©es... 35%\r(Lecture de la base de donn√©es... 40%\r(Lecture de la base de donn√©es... 45%\r(Lecture de la base de donn√©es... 50%\r(Lecture de la base de donn√©es... 55%\r(Lecture de la base de donn√©es... 60%\r(Lecture de la base de donn√©es... 65%\r(Lecture de la base de donn√©es... 70%\r(Lecture de la base de donn√©es... 75%\r(Lecture de la base de donn√©es... 80%\r(Lecture de la base de donn√©es... 85%\r(Lecture de la base de donn√©es... 90%\r(Lecture de la base de donn√©es... 95%\r(Lecture de la base de donn√©es... 100%\r(Lecture de la base de donn√©es... 438132 fichiers et r√©pertoires d√©j√† install√©s.)\r\nPr√©paration du d√©paquetage de .../jq_1.6-2.1ubuntu3_amd64.deb ...\r\nD√©paquetage de jq (1.6-2.1ubuntu3) ...\r\nParam√©trage de jq (1.6-2.1ubuntu3) ...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†...\r\n", "stdout_lines": ["Lecture des listes de paquets‚Ä¶", "Construction de l'arbre des d√©pendances‚Ä¶", "Lecture des informations d'√©tat‚Ä¶", "Les NOUVEAUX paquets suivants seront install√©s¬†:", "  jq", "0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.", "Il est n√©cessaire de prendre 52.5 ko dans les archives.", "Apr√®s cette op√©ration, 102 ko d'espace disque suppl√©mentaires seront utilis√©s.", "R√©ception de¬†:1 http://gpl.savoirfairelinux.net/pub/mirrors/ubuntu jammy/main amd64 jq amd64 1.6-2.1ubuntu3 [52.5 kB]", "52.5 ko r√©ceptionn√©s en 0s (476 ko/s)", "S√©lection du paquet jq pr√©c√©demment d√©s√©lectionn√©.", "(Lecture de la base de donn√©es... ", "(Lecture de la base de donn√©es... 5%", "(Lecture de la base de donn√©es... 10%", "(Lecture de la base de donn√©es... 15%", "(Lecture de la base de donn√©es... 20%", "(Lecture de la base de donn√©es... 25%", "(Lecture de la base de donn√©es... 30%", "(Lecture de la base de donn√©es... 35%", "(Lecture de la base de donn√©es... 40%", "(Lecture de la base de donn√©es... 45%", "(Lecture de la base de donn√©es... 50%", "(Lecture de la base de donn√©es... 55%", "(Lecture de la base de donn√©es... 60%", "(Lecture de la base de donn√©es... 65%", "(Lecture de la base de donn√©es... 70%", "(Lecture de la base de donn√©es... 75%", "(Lecture de la base de donn√©es... 80%", "(Lecture de la base de donn√©es... 85%", "(Lecture de la base de donn√©es... 90%", "(Lecture de la base de donn√©es... 95%", "(Lecture de la base de donn√©es... 100%", "(Lecture de la base de donn√©es... 438132 fichiers et r√©pertoires d√©j√† install√©s.)", "Pr√©paration du d√©paquetage de .../jq_1.6-2.1ubuntu3_amd64.deb ...", "D√©paquetage de jq (1.6-2.1ubuntu3) ...", "Param√©trage de jq (1.6-2.1ubuntu3) ...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†..."]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
</details>

> üí° **Explications**¬†: Le playbook installe le paquet `jq`.

## Installation et configuration de VS Code
Pour n‚Äôinstaller que VS Code, ex√©cuter localement la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags vscode
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [Installation de VSCode] ******************************************************************************************************************************************************************************
changed: [localhost] => {"changed": true, "channel": "latest/stable", "classic": true, "cmd": "['state', 'classic', 'channel', 'dangerous', 'code']", "snap_names": ["code"], "snaps_installed": ["code"]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
</details>

Aper√ßu de VS Code sous Ubuntu¬†:

![VS Code](./docs/vscode_window.png)

> üí° **Explications**¬†: Le playbook Ansible installe le snap nomm√© _[code](https://snapcraft.io/code)_.

## Installation et configuration de GitHub Desktop (et Git)
Pour n‚Äôinstaller que GitHub Desktop, ex√©cuter la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags github-desktop
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [T√©l√©chargement de la clef PGP du d√©p√¥t] **************************************************************************************************************************************************************
changed: [localhost] => {"after": ["7FC979028B1997C1", "DE58E9B416EB1F95"], "before": [], "changed": true, "fp": "7FC979028B1997C1", "id": "7FC979028B1997C1", "key_id": "7FC979028B1997C1", "short_id": "8B1997C1"}

ASK [Ajout du d√©p√¥t GitHub Desktop] ***********************************************************************************************************************************************************************
changed: [localhost] => {"changed": true, "repo": "deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_shiftkey_repo-archive-keyring.gpg] https://apt.packages.shiftkey.dev/ubuntu/ any main", "sources_added": [], "sources_removed": [], "state": "present"}

TASK [Installation de GitHub Desktop] **********************************************************************************************************************************************************************
Lecture des listes de paquets‚Ä¶
Construction de l'arbre des d√©pendances‚Ä¶
Lecture des informations d'√©tat‚Ä¶
Paquets sugg√©r√©s¬†:
  gir1.2-gnomekeyring-1.0 libgnome-keyring0
Les NOUVEAUX paquets suivants seront install√©s¬†:
  github-desktop
0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.
Il est n√©cessaire de prendre 94.6 Mo dans les archives.
Apr√®s cette op√©ration, 345 Mo d'espace disque suppl√©mentaires seront utilis√©s.
R√©ception de¬†:1 https://apt.packages.shiftkey.dev/ubuntu any/main amd64 github-desktop amd64 3.3.8-linux1 [94.6 MB]
94.6 Mo r√©ceptionn√©s en 12s (8052 ko/s)
S√©lection du paquet github-desktop pr√©c√©demment d√©s√©lectionn√©.
(Lecture de la base de donn√©es... 
(Lecture de la base de donn√©es... 5%
(Lecture de la base de donn√©es... 10%
(Lecture de la base de donn√©es... 15%
(Lecture de la base de donn√©es... 20%
(Lecture de la base de donn√©es... 25%
(Lecture de la base de donn√©es... 30%
(Lecture de la base de donn√©es... 35%
(Lecture de la base de donn√©es... 40%
(Lecture de la base de donn√©es... 45%
(Lecture de la base de donn√©es... 50%
(Lecture de la base de donn√©es... 55%
(Lecture de la base de donn√©es... 60%
(Lecture de la base de donn√©es... 65%
(Lecture de la base de donn√©es... 70%
(Lecture de la base de donn√©es... 75%
(Lecture de la base de donn√©es... 80%
(Lecture de la base de donn√©es... 85%
(Lecture de la base de donn√©es... 90%
(Lecture de la base de donn√©es... 95%
(Lecture de la base de donn√©es... 100%
(Lecture de la base de donn√©es... 436345 fichiers et r√©pertoires d√©j√† install√©s.)
Pr√©paration du d√©paquetage de .../github-desktop_3.3.8-linux1_amd64.deb ...
D√©paquetage de github-desktop (3.3.8-linux1) ...
Param√©trage de github-desktop (3.3.8-linux1) ...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour desktop-file-utils (0.26-1ubuntu3)¬†...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour hicolor-icon-theme (0.17-2)¬†...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour gnome-menus (3.36.0-1ubuntu3)¬†...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour mailcap (3.70+nmu1ubuntu1)¬†...
changed: [localhost] => {"cache_update_time": 1710049877, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Lecture des listes de paquets‚Ä¶\nConstruction de l'arbre des d√©pendances‚Ä¶\nLecture des informations d'√©tat‚Ä¶\nPaquets sugg√©r√©s¬†:\n  gir1.2-gnomekeyring-1.0 libgnome-keyring0\nLes NOUVEAUX paquets suivants seront install√©s¬†:\n  github-desktop\n0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.\nIl est n√©cessaire de prendre 94.6 Mo dans les archives.\nApr√®s cette op√©ration, 345 Mo d'espace disque suppl√©mentaires seront utilis√©s.\nR√©ception de¬†:1 https://apt.packages.shiftkey.dev/ubuntu any/main amd64 github-desktop amd64 3.3.8-linux1 [94.6 MB]\n94.6 Mo r√©ceptionn√©s en 12s (8052 ko/s)\nS√©lection du paquet github-desktop pr√©c√©demment d√©s√©lectionn√©.\r\n(Lecture de la base de donn√©es... \r(Lecture de la base de donn√©es... 5%\r(Lecture de la base de donn√©es... 10%\r(Lecture de la base de donn√©es... 15%\r(Lecture de la base de donn√©es... 20%\r(Lecture de la base de donn√©es... 25%\r(Lecture de la base de donn√©es... 30%\r(Lecture de la base de donn√©es... 35%\r(Lecture de la base de donn√©es... 40%\r(Lecture de la base de donn√©es... 45%\r(Lecture de la base de donn√©es... 50%\r(Lecture de la base de donn√©es... 55%\r(Lecture de la base de donn√©es... 60%\r(Lecture de la base de donn√©es... 65%\r(Lecture de la base de donn√©es... 70%\r(Lecture de la base de donn√©es... 75%\r(Lecture de la base de donn√©es... 80%\r(Lecture de la base de donn√©es... 85%\r(Lecture de la base de donn√©es... 90%\r(Lecture de la base de donn√©es... 95%\r(Lecture de la base de donn√©es... 100%\r(Lecture de la base de donn√©es... 436345 fichiers et r√©pertoires d√©j√† install√©s.)\r\nPr√©paration du d√©paquetage de .../github-desktop_3.3.8-linux1_amd64.deb ...\r\nD√©paquetage de github-desktop (3.3.8-linux1) ...\r\nParam√©trage de github-desktop (3.3.8-linux1) ...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour desktop-file-utils (0.26-1ubuntu3)¬†...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour hicolor-icon-theme (0.17-2)¬†...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour gnome-menus (3.36.0-1ubuntu3)¬†...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour mailcap (3.70+nmu1ubuntu1)¬†...\r\n", "stdout_lines": ["Lecture des listes de paquets‚Ä¶", "Construction de l'arbre des d√©pendances‚Ä¶", "Lecture des informations d'√©tat‚Ä¶", "Paquets sugg√©r√©s¬†:", "  gir1.2-gnomekeyring-1.0 libgnome-keyring0", "Les NOUVEAUX paquets suivants seront install√©s¬†:", "  github-desktop", "0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.", "Il est n√©cessaire de prendre 94.6 Mo dans les archives.", "Apr√®s cette op√©ration, 345 Mo d'espace disque suppl√©mentaires seront utilis√©s.", "R√©ception de¬†:1 https://apt.packages.shiftkey.dev/ubuntu any/main amd64 github-desktop amd64 3.3.8-linux1 [94.6 MB]", "94.6 Mo r√©ceptionn√©s en 12s (8052 ko/s)", "S√©lection du paquet github-desktop pr√©c√©demment d√©s√©lectionn√©.", "(Lecture de la base de donn√©es... ", "(Lecture de la base de donn√©es... 5%", "(Lecture de la base de donn√©es... 10%", "(Lecture de la base de donn√©es... 15%", "(Lecture de la base de donn√©es... 20%", "(Lecture de la base de donn√©es... 25%", "(Lecture de la base de donn√©es... 30%", "(Lecture de la base de donn√©es... 35%", "(Lecture de la base de donn√©es... 40%", "(Lecture de la base de donn√©es... 45%", "(Lecture de la base de donn√©es... 50%", "(Lecture de la base de donn√©es... 55%", "(Lecture de la base de donn√©es... 60%", "(Lecture de la base de donn√©es... 65%", "(Lecture de la base de donn√©es... 70%", "(Lecture de la base de donn√©es... 75%", "(Lecture de la base de donn√©es... 80%", "(Lecture de la base de donn√©es... 85%", "(Lecture de la base de donn√©es... 90%", "(Lecture de la base de donn√©es... 95%", "(Lecture de la base de donn√©es... 100%", "(Lecture de la base de donn√©es... 436345 fichiers et r√©pertoires d√©j√† install√©s.)", "Pr√©paration du d√©paquetage de .../github-desktop_3.3.8-linux1_amd64.deb ...", "D√©paquetage de github-desktop (3.3.8-linux1) ...", "Param√©trage de github-desktop (3.3.8-linux1) ...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour desktop-file-utils (0.26-1ubuntu3)¬†...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour hicolor-icon-theme (0.17-2)¬†...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour gnome-menus (3.36.0-1ubuntu3)¬†...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour mailcap (3.70+nmu1ubuntu1)¬†..."]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=4    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignores=0
```
</details>

> üí° **Explications**¬†: Le playbook t√©l√©charge premi√®rement la clef (PGP) d‚Äôun d√©p√¥t (non-officiel).  Le d√©p√¥t est aussi configur√©.  Finalement, le paquet `github-desktop` est install√©.

### Configuration de GitHub Desktop
En lan√ßant l‚Äôapplication, cliquer sur ¬´¬†_Sign in to GitHub.com_¬†¬ª¬†:

![GitHub Desktop connexion](./docs/github_desktop_first_page.png)

> ‚ö†Ô∏è **Attention**¬†: Puisque mon navigateur √©tait d√©j√† connect√© √† GitHub, le processus d‚Äôauthentification n‚Äô√©tait requis.

Remplir les configuration de Git pour GitHub Desktop¬†:

![GitHub Desktop Git](./docs/github_desktop_configure_git.png)

Aper√ßu de GitHub Desktop sous Ubuntu¬†:

![GitHub Desktop](./docs/github_desktop_window.png)

### GitHub CLI
> üìù **Note¬†:** Cette √©tape est requise pour la cr√©ation automatique de d√©p√¥ts distants par ligne de commande.

#### Installation de GitHub CLI
Pour n‚Äôinstaller que GitHub CLI, ex√©cuter localement la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags github-cli
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [T√©l√©chargement de la clef PGP du d√©p√¥t] **************************************************************************************************************************************************************
changed: [localhost] => {"after": ["23F3D4EA75716059", "E5FAF19590714157"], "before": [], "changed": true, "fp": "23F3D4EA75716059", "id": "23F3D4EA75716059", "key_id": "23F3D4EA75716059", "short_id": "75716059"}

TASK [Ajout du d√©p√¥t GitHub CLI] ***************************************************************************************************************************************************************************
changed: [localhost] => {"changed": true, "repo": "deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_githubcli_repo-archive-keyring.gpg] https://cli.github.com/packages stable main", "sources_added": [], "sources_removed": [], "state": "present"}

TASK [Installation de GitHub CLI] **************************************************************************************************************************************************************************
Lecture des listes de paquets‚Ä¶
Construction de l'arbre des d√©pendances‚Ä¶
Lecture des informations d'√©tat‚Ä¶
Les NOUVEAUX paquets suivants seront install√©s¬†:
  gh
0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.
Il est n√©cessaire de prendre 0 o/11.3 Mo dans les archives.
Apr√®s cette op√©ration, 43.7 Mo d'espace disque suppl√©mentaires seront utilis√©s.
S√©lection du paquet gh pr√©c√©demment d√©s√©lectionn√©.
(Lecture de la base de donn√©es... 
(Lecture de la base de donn√©es... 5%
(Lecture de la base de donn√©es... 10%
(Lecture de la base de donn√©es... 15%
(Lecture de la base de donn√©es... 20%
(Lecture de la base de donn√©es... 25%
(Lecture de la base de donn√©es... 30%
(Lecture de la base de donn√©es... 35%
(Lecture de la base de donn√©es... 40%
(Lecture de la base de donn√©es... 45%
(Lecture de la base de donn√©es... 50%
(Lecture de la base de donn√©es... 55%
(Lecture de la base de donn√©es... 60%
(Lecture de la base de donn√©es... 65%
(Lecture de la base de donn√©es... 70%
(Lecture de la base de donn√©es... 75%
(Lecture de la base de donn√©es... 80%
(Lecture de la base de donn√©es... 85%
(Lecture de la base de donn√©es... 90%
(Lecture de la base de donn√©es... 95%
(Lecture de la base de donn√©es... 100%
(Lecture de la base de donn√©es... 437959 fichiers et r√©pertoires d√©j√† install√©s.)
Pr√©paration du d√©paquetage de .../archives/gh_2.45.0_amd64.deb ...
D√©paquetage de gh (2.45.0) ...
Param√©trage de gh (2.45.0) ...
Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†...
changed: [localhost] => {"cache_update_time": 1710051479, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Lecture des listes de paquets‚Ä¶\nConstruction de l'arbre des d√©pendances‚Ä¶\nLecture des informations d'√©tat‚Ä¶\nLes NOUVEAUX paquets suivants seront install√©s¬†:\n  gh\n0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.\nIl est n√©cessaire de prendre 0 o/11.3 Mo dans les archives.\nApr√®s cette op√©ration, 43.7 Mo d'espace disque suppl√©mentaires seront utilis√©s.\nS√©lection du paquet gh pr√©c√©demment d√©s√©lectionn√©.\r\n(Lecture de la base de donn√©es... \r(Lecture de la base de donn√©es... 5%\r(Lecture de la base de donn√©es... 10%\r(Lecture de la base de donn√©es... 15%\r(Lecture de la base de donn√©es... 20%\r(Lecture de la base de donn√©es... 25%\r(Lecture de la base de donn√©es... 30%\r(Lecture de la base de donn√©es... 35%\r(Lecture de la base de donn√©es... 40%\r(Lecture de la base de donn√©es... 45%\r(Lecture de la base de donn√©es... 50%\r(Lecture de la base de donn√©es... 55%\r(Lecture de la base de donn√©es... 60%\r(Lecture de la base de donn√©es... 65%\r(Lecture de la base de donn√©es... 70%\r(Lecture de la base de donn√©es... 75%\r(Lecture de la base de donn√©es... 80%\r(Lecture de la base de donn√©es... 85%\r(Lecture de la base de donn√©es... 90%\r(Lecture de la base de donn√©es... 95%\r(Lecture de la base de donn√©es... 100%\r(Lecture de la base de donn√©es... 437959 fichiers et r√©pertoires d√©j√† install√©s.)\r\nPr√©paration du d√©paquetage de .../archives/gh_2.45.0_amd64.deb ...\r\nD√©paquetage de gh (2.45.0) ...\r\nParam√©trage de gh (2.45.0) ...\r\nTraitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†...\r\n", "stdout_lines": ["Lecture des listes de paquets‚Ä¶", "Construction de l'arbre des d√©pendances‚Ä¶", "Lecture des informations d'√©tat‚Ä¶", "Les NOUVEAUX paquets suivants seront install√©s¬†:", "  gh", "0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.", "Il est n√©cessaire de prendre 0 o/11.3 Mo dans les archives.", "Apr√®s cette op√©ration, 43.7 Mo d'espace disque suppl√©mentaires seront utilis√©s.", "S√©lection du paquet gh pr√©c√©demment d√©s√©lectionn√©.", "(Lecture de la base de donn√©es... ", "(Lecture de la base de donn√©es... 5%", "(Lecture de la base de donn√©es... 10%", "(Lecture de la base de donn√©es... 15%", "(Lecture de la base de donn√©es... 20%", "(Lecture de la base de donn√©es... 25%", "(Lecture de la base de donn√©es... 30%", "(Lecture de la base de donn√©es... 35%", "(Lecture de la base de donn√©es... 40%", "(Lecture de la base de donn√©es... 45%", "(Lecture de la base de donn√©es... 50%", "(Lecture de la base de donn√©es... 55%", "(Lecture de la base de donn√©es... 60%", "(Lecture de la base de donn√©es... 65%", "(Lecture de la base de donn√©es... 70%", "(Lecture de la base de donn√©es... 75%", "(Lecture de la base de donn√©es... 80%", "(Lecture de la base de donn√©es... 85%", "(Lecture de la base de donn√©es... 90%", "(Lecture de la base de donn√©es... 95%", "(Lecture de la base de donn√©es... 100%", "(Lecture de la base de donn√©es... 437959 fichiers et r√©pertoires d√©j√† install√©s.)", "Pr√©paration du d√©paquetage de .../archives/gh_2.45.0_amd64.deb ...", "D√©paquetage de gh (2.45.0) ...", "Param√©trage de gh (2.45.0) ...", "Traitement des actions diff√©r√©es (¬´¬†triggers¬†¬ª) pour man-db (2.10.2-1)¬†..."]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
</details>

> üí° **Explications**¬†: Le playbook t√©l√©charge premi√®rement la clef (PGP) du d√©p√¥t officiel.  Le d√©p√¥t est aussi configur√©.  Finalement, le paquet `gh` est install√©.

#### Connexion de GitHub CLI (`gh`) au compte GitHub
Pour connecter l‚Äôutilitaire, ex√©cuter localement cette commande¬†:

```bash
gh auth login
```

<details>
  <summary>Un invite demandera d‚Äôutiliser un type de compte.  Choisir d‚Äôutiliser GitHub.com¬†:</summary>

```console
? What account do you want to log into?  [Use arrows to move, type to filter]
> GitHub.com
  GitHub Enterprise Server
```
</details>

<details>
  <summary>Choisir l‚Äôauthentification avec SSH.  Cette m√©thode est plus s√©curitaire¬†:</summary>

```console
? What is your preferred protocol for Git operations on this host?  [Use arrows to move, type to filter]
  HTTPS
> SSH
```
</details>

> ‚ö†Ô∏è **Note¬†:** √âtant donn√© mon utilisation de [gpg-agent](https://gist.github.com/mcattarinussi/834fc4b641ff4572018d0c665e5a94d3), ce document ne montrera pas le processus de cr√©ation d‚Äôune paire de clefs SSH

<details>
  <summary>Choisir la clef publique SSH √† utiliser¬†:</summary>

```console
? Upload your SSH public key to your GitHub account? ~/.ssh/XXXX.pub
```
</details>

<details>
  <summary>Fournir un nom pour la clef publique¬†:</summary>

```console
? Title for your SSH key: GitHub CLI
```
</details>

<details>
  <summary>Utiliser le navigateur pour authentifier GitHub CLI¬†:</summary>

```console
? How would you like to authenticate GitHub CLI?  [Use arrows to move, type to filter]
> Login with a web browser
  Paste an authentication token
```
</details>


<details>
  <summary>Noter le code fourni et appuyer sur <kbd>entr√©e</kbd> pour ouvrir le navigateur web¬†:</summary>

```console
! First copy your one-time code: XXXX-XXXX
Press Enter to open github.com in your browser...
```
</details>

Entrer le code d‚Äôactivation¬†:

![Code d‚Äôactivation GH CLI](./docs/gh_activation_otp.png)

Autoriser l‚Äôapplication (GitHub CLI) √† acc√©der au compte GitHub¬†:

![Autorisation pour GH CLI](./docs/gh_activation_authorization.png)

Suivant la r√©ussite du processus d‚Äôautorisation, un message sera affich√©¬†:

![Activation de GH CLI](./docs/gh_activation_success.png)

<details>
  <summary>L‚Äôutilitaire affichera les actions pos√©es¬†:</summary>

```console
‚úì Authentication complete.
- gh config set -h github.com git_protocol ssh
‚úì Configured git protocol
‚úì SSH key already existed on your GitHub account: ~/.ssh/XXXX.pub
‚úì Logged in as notetiene
```
</details>

### Cr√©ation d‚Äôun d√©p√¥t local Git
Dans un r√©pertoire, cr√©er un d√©p√¥t git¬†:

```bash
REPO_NAME=cr460-de01
mkdir ~/$REPO_NAME && cd ~/$REPO_NAME
git init
```

<details>
  <summary>R√©sultats de la commande¬†:</summary>

```console
Initialized empty Git repository in /home/etienne/cr460-de01/.git/
```
</details>

> üí° **Explications**¬†: Cette commande cr√©e et acc√®de √† un nouveau r√©pertoire.  Un d√©p√¥t vide (Git) est par la suite initialis√©.

#### Ajout du premier commit
Pour permettre de cr√©er un premier commit, cr√©er un fichier vide¬†:

```bash
REPO_NAME=cr460-de01
cd ~/$REPO_NAME
touch README.md
```

> üí° **Explications**¬†: Cette commande cr√©e un fichier vide dans le r√©pertoire du d√©p√¥t.

Ajout du fichier vide dans l‚Äôindex¬†:
```bash
git add README.md
```

(V√©rification de l‚Äôindex (_staging area_))

```bash
git status
```

<details>
  <summary>R√©sultats de la commande¬†:</summary>

```console
On branch main

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)
	new file:   README.md
```
</details>

Cr√©er le premier commit¬†:

```bash
git commit -m "Premier commit"
```

> üí° **Explications**¬†: Cette commande cr√©√©e un commit avec l‚Äôindex courant en utilisant le message ¬´¬†Premier commit¬†¬ª.

### Cr√©ation d‚Äôun d√©p√¥t distant avec GitHub
Pour cr√©er un d√©p√¥t distant, `gh` a √©t√© utilis√©.

```bash
REPO_NAME=cr460-de01
gh repo create $REPO_NAME --public
```

<details>
  <summary>Le d√©p√¥t a √©t√© cr√©√©¬†:</summary>

```console
‚úì Created repository notetiene/cr460-de01 on GitHub
  https://github.com/notetiene/cr460-de01
```
</details>

> üí° **Explications**¬†: Cette commande cr√©√©e un d√©p√¥t Git public sur le compte li√© de GitHub.

Ajout d‚Äôune description au d√©p√¥t distant¬†:

```bash
gh repo edit notetiene/cr460-de01 --description "Devoir 01 pour le cours CR460"
```

<details>
  <summary>R√©sultats de la commande¬†:</summary>

```console
‚úì Edited repository notetiene/cr460-de01
```
</details>

> üí° **Explications**¬†: Cette commande configure le message d‚Äôaffichage du nouveau d√©p√¥t cr√©√© (GitHub).

### Mise √† jour du d√©p√¥t suivi (_remote_)
L‚ÄôURL SSH du d√©p√¥t distant doit √™tre r√©cup√©r√©e¬†:

```bash
REPO_NAME=cr460-de01
REPO_SSH="$(gh repo view $REPO_NAME --json sshUrl | jq -r '.sshUrl')"
```

> üí° **Explications**¬†: Cette commande r√©cup√®re l‚ÄôURL distant configur√© du d√©p√¥t sur GitHub (en format JSON).  L‚Äôutilitaire `jq` ne r√©cup√®re que le champs `sshUrl`.

Ajouter le distant (en utilisant le nom `origin`) et l‚ÄôURL SSH.  Forcer la synchronisation¬†:

```bash
cd ~/$REPO_NAME
git remote add -f origin $REPO_SSH
```

<details>
  <summary>Mise √† jour du distant¬†:</summary>

```console
Updating origin
remote: Enumerating objects: 119, done.
remote: Counting objects: 100% (119/119), done.
remote: Compressing objects: 100% (69/69), done.
remote: Total 119 (delta 64), reused 103 (delta 48), pack-reused 0
Receiving objects: 100% (119/119), 684.24 KiB | 4.22 MiB/s, done.
Resolving deltas: 100% (64/64), done.
From github.com:notetiene/cr460-de01
 * [new branch]      main       -> origin/main
```
</details>
Configurer branche en amont par d√©faut¬†:

```bash
git push --set-upstream origin main
```

<details>
  <summary>R√©sultats de la commande¬†:</summary>

```console
branch 'main' set up to track 'origin/main'.
Everything up-to-date
```
</details>

## Terraform CLI et Terraform cloud
### Installation de Terraform CLI
Pour n‚Äôinstaller que Terraform, ex√©cuter localement la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags terraform
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [T√©l√©chargement de la clef PGP de HashiCorp] **********************************************************************************************************************************************************
changed: [localhost] => {"after": ["AA16FCBCA621E701", "706E668369C085E9"], "before": [], "changed": true, "fp": "AA16FCBCA621E701", "id": "AA16FCBCA621E701", "key_id": "AA16FCBCA621E701", "short_id": "A621E701"}

TASK [Ajout du d√©p√¥t de HashiCorp] *************************************************************************************************************************************************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/ansible_hashicorp.list
@@ -0,0 +1 @@
+deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_hashicorp_archive-keyring.gpg] https://apt.releases.hashicorp.com jammy main

changed: [localhost] => {"changed": true, "repo": "deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_hashicorp_archive-keyring.gpg] https://apt.releases.hashicorp.com jammy main", "sources_added": ["/etc/apt/sources.list.d/ansible_hashicorp.list"], "sources_removed": [], "state": "present"}

TASK [Installation de Terraform] ***************************************************************************************************************************************************************************
Lecture des listes de paquets‚Ä¶
Construction de l'arbre des d√©pendances‚Ä¶
Lecture des informations d'√©tat‚Ä¶
Les NOUVEAUX paquets suivants seront install√©s¬†:
  terraform
0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.
Il est n√©cessaire de prendre 26.9 Mo dans les archives.
Apr√®s cette op√©ration, 84.5 Mo d'espace disque suppl√©mentaires seront utilis√©s.
R√©ception de¬†:1 https://apt.releases.hashicorp.com jammy/main amd64 terraform amd64 1.7.4-1 [26.9 MB]
26.9 Mo r√©ceptionn√©s en 3s (7794 ko/s)
S√©lection du paquet terraform pr√©c√©demment d√©s√©lectionn√©.
(Lecture de la base de donn√©es... 
(Lecture de la base de donn√©es... 5%
(Lecture de la base de donn√©es... 10%
(Lecture de la base de donn√©es... 15%
(Lecture de la base de donn√©es... 20%
(Lecture de la base de donn√©es... 25%
(Lecture de la base de donn√©es... 30%
(Lecture de la base de donn√©es... 35%
(Lecture de la base de donn√©es... 40%
(Lecture de la base de donn√©es... 45%
(Lecture de la base de donn√©es... 50%
(Lecture de la base de donn√©es... 55%
(Lecture de la base de donn√©es... 60%
(Lecture de la base de donn√©es... 65%
(Lecture de la base de donn√©es... 70%
(Lecture de la base de donn√©es... 75%
(Lecture de la base de donn√©es... 80%
(Lecture de la base de donn√©es... 85%
(Lecture de la base de donn√©es... 90%
(Lecture de la base de donn√©es... 95%
(Lecture de la base de donn√©es... 100%
(Lecture de la base de donn√©es... 438148 fichiers et r√©pertoires d√©j√† install√©s.)
Pr√©paration du d√©paquetage de .../terraform_1.7.4-1_amd64.deb ...
D√©paquetage de terraform (1.7.4-1) ...
Param√©trage de terraform (1.7.4-1) ...
changed: [localhost] => {"cache_update_time": 1710051781, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Lecture des listes de paquets‚Ä¶\nConstruction de l'arbre des d√©pendances‚Ä¶\nLecture des informations d'√©tat‚Ä¶\nLes NOUVEAUX paquets suivants seront install√©s¬†:\n  terraform\n0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.\nIl est n√©cessaire de prendre 26.9 Mo dans les archives.\nApr√®s cette op√©ration, 84.5 Mo d'espace disque suppl√©mentaires seront utilis√©s.\nR√©ception de¬†:1 https://apt.releases.hashicorp.com jammy/main amd64 terraform amd64 1.7.4-1 [26.9 MB]\n26.9 Mo r√©ceptionn√©s en 3s (7794 ko/s)\nS√©lection du paquet terraform pr√©c√©demment d√©s√©lectionn√©.\r\n(Lecture de la base de donn√©es... \r(Lecture de la base de donn√©es... 5%\r(Lecture de la base de donn√©es... 10%\r(Lecture de la base de donn√©es... 15%\r(Lecture de la base de donn√©es... 20%\r(Lecture de la base de donn√©es... 25%\r(Lecture de la base de donn√©es... 30%\r(Lecture de la base de donn√©es... 35%\r(Lecture de la base de donn√©es... 40%\r(Lecture de la base de donn√©es... 45%\r(Lecture de la base de donn√©es... 50%\r(Lecture de la base de donn√©es... 55%\r(Lecture de la base de donn√©es... 60%\r(Lecture de la base de donn√©es... 65%\r(Lecture de la base de donn√©es... 70%\r(Lecture de la base de donn√©es... 75%\r(Lecture de la base de donn√©es... 80%\r(Lecture de la base de donn√©es... 85%\r(Lecture de la base de donn√©es... 90%\r(Lecture de la base de donn√©es... 95%\r(Lecture de la base de donn√©es... 100%\r(Lecture de la base de donn√©es... 438148 fichiers et r√©pertoires d√©j√† install√©s.)\r\nPr√©paration du d√©paquetage de .../terraform_1.7.4-1_amd64.deb ...\r\nD√©paquetage de terraform (1.7.4-1) ...\r\nParam√©trage de terraform (1.7.4-1) ...\r\n", "stdout_lines": ["Lecture des listes de paquets‚Ä¶", "Construction de l'arbre des d√©pendances‚Ä¶", "Lecture des informations d'√©tat‚Ä¶", "Les NOUVEAUX paquets suivants seront install√©s¬†:", "  terraform", "0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.", "Il est n√©cessaire de prendre 26.9 Mo dans les archives.", "Apr√®s cette op√©ration, 84.5 Mo d'espace disque suppl√©mentaires seront utilis√©s.", "R√©ception de¬†:1 https://apt.releases.hashicorp.com jammy/main amd64 terraform amd64 1.7.4-1 [26.9 MB]", "26.9 Mo r√©ceptionn√©s en 3s (7794 ko/s)", "S√©lection du paquet terraform pr√©c√©demment d√©s√©lectionn√©.", "(Lecture de la base de donn√©es... ", "(Lecture de la base de donn√©es... 5%", "(Lecture de la base de donn√©es... 10%", "(Lecture de la base de donn√©es... 15%", "(Lecture de la base de donn√©es... 20%", "(Lecture de la base de donn√©es... 25%", "(Lecture de la base de donn√©es... 30%", "(Lecture de la base de donn√©es... 35%", "(Lecture de la base de donn√©es... 40%", "(Lecture de la base de donn√©es... 45%", "(Lecture de la base de donn√©es... 50%", "(Lecture de la base de donn√©es... 55%", "(Lecture de la base de donn√©es... 60%", "(Lecture de la base de donn√©es... 65%", "(Lecture de la base de donn√©es... 70%", "(Lecture de la base de donn√©es... 75%", "(Lecture de la base de donn√©es... 80%", "(Lecture de la base de donn√©es... 85%", "(Lecture de la base de donn√©es... 90%", "(Lecture de la base de donn√©es... 95%", "(Lecture de la base de donn√©es... 100%", "(Lecture de la base de donn√©es... 438148 fichiers et r√©pertoires d√©j√† install√©s.)", "Pr√©paration du d√©paquetage de .../terraform_1.7.4-1_amd64.deb ...", "D√©paquetage de terraform (1.7.4-1) ...", "Param√©trage de terraform (1.7.4-1) ..."]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
</details>

> üí° **Explications**¬†: Le playbook t√©l√©charge premi√®rement la clef (PGP) du d√©p√¥t officiel.  Le d√©p√¥t est aussi configur√©.  Finalement, le paquet `terraform` est install√©.

### Test de Terraform CLI
> ‚ö†Ô∏è **Note¬†:** Consid√©rant que le devoir exige la mise en place de la pratique CI/CD, l‚Äô√©tape de cr√©ation des ressources (`plan` et  `apply`) ne s‚Äôeffectuera pas sur une machine locale.

Ex√©cuter la commande d‚Äôinitialisation de terraform dans la copie du d√©p√¥t¬†:

```bash
REPO_NAME=cr460-de01
cd ~/$REPO_NAME
terraform init
```

<details>
  <summary>R√©sultats de l‚Äôinitialisation de <code>terraform init</code>¬†:</summary>

```console
Initializing the backend...

Successfully configured the backend "remote"! Terraform will automatically
use this backend unless the backend configuration changes.

Initializing provider plugins...
- Finding latest version of hashicorp/azurerm...
- Installing hashicorp/azurerm v3.95.0...
- Installed hashicorp/azurerm v3.95.0 (signed by HashiCorp)

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
```
</details>

> üí° **Explications**¬†: Terraform analyse les fichiers de langage `.tf` pour configurer le r√©pertoire courant √† l‚Äôex√©cution d‚Äô√©tapes ult√©rieures.

Supprimer les fichiers d‚Äôinitialisation¬†:

```bash
rm -Rf .terraform/ .terraform.lock.hcl
```

### Activation de Terraform cloud
Avec Terraform install√©, enregistrer le compte _cloud_ avec l‚Äôutilitaire¬†:

```bash
terraform login
```

<details>
  <summary>Une confirmation sera demand√©e¬†:</summary>

```console
If login is successful, Terraform will store the token in plain text in
the following file for use by subsequent commands:
    /home/etienne/.terraform.d/credentials.tfrc.json

*Do you want to proceed?*
  Only 'yes' will be accepted to confirm.

  *Enter a value:* yes

```
</details>

Entrer `yes`


<details>
  <summary>Un jeton sera demand√©¬†:</summary>

```console
---------------------------------------------------------------------------------

Terraform must now open a web browser to the tokens page for app.terraform.io.

If a browser does not open this automatically, open the following URL to proceed:
    https://app.terraform.io/app/settings/tokens?source=terraform-login


---------------------------------------------------------------------------------

Generate a token using your browser, and copy-paste it into this prompt.

Terraform will store the token in plain text in the following file
for use by subsequent commands:
    /home/etienne/.terraform.d/credentials.tfrc.json

Token for app.terraform.io:
  Enter a value: XXXXXX
```
</details>

Terraform va ouvrir automatiquement le navigateur web.  Se connecter √† Terraform¬†:

![Connexion Terraform cloud](./docs/terraform_cloud_login.png)

Cr√©er un jeton pour Terraform login¬†:

![Cr√©ation jeton](./docs/terraform_cloud_login_token_creation.png)

Prendre en note le jeton cr√©√©¬†:

![Cr√©ation jeton](./docs/terraform_cloud_login_token_success.png)


<details>
  <summary>Entrer le jeton dans le champ demand√© pour `terraform login`¬†:</summary>

```console
---------------------------------------------------------------------------------
Token for app.terraform.io:
  Enter a value: XXXXXX


Retrieved token for user notetiene


---------------------------------------------------------------------------------

                                          -
                                          -----                           -
                                          ---------                      --
                                          ---------  -                -----
                                           ---------  ------        -------
                                             -------  ---------  ----------
                                                ----  ---------- ----------
                                                  --  ---------- ----------
   Welcome to Terraform Cloud!                     -  ---------- -------
                                                      ---  ----- ---
   Documentation: terraform.io/docs/cloud             --------   -
                                                      ----------
                                                      ----------
                                                       ---------
                                                           -----
                                                               -


   New to TFC? Follow these steps to instantly apply an example configuration:

   $ git clone https://github.com/hashicorp/tfc-getting-started.git
   $ cd tfc-getting-started
   $ scripts/setup.sh
```
</details>

Terraform cloud peut maintenant √™tre configur√© localement.

### Cr√©ation d‚Äôune nouvelle organisation Terraform Cloud
Pour cr√©er un nouvelle organisation ajouter ces blocs au fichier [terraform-cloud/org.tf](./terraform-cloud/org.tf).

```terraform
# Variable declaration with default values
variable "org_name" {
  type        = string
  description = "Terraform organization name."
  default     = "polymtl-cr460"
}

variable "org_email" {
  type        = string
  description = "Terraform organization email."
  default     = "e.e.f.prudhomme@gmail.com"
}

# Create a new terraform cloud organization
resource "tfe_organization" "org" {
  name  = var.org_name
  email = var.org_email
}
```

Ex√©cuter localement¬†:

```bash
REPO_NAME=cr460-de01
cd ~/$REPO_NAME/terraform-cloud/
terraform init
terraform plan
terraform apply
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution des commandes <code>terraform</code>¬†:</summary>

```console
Initializing the backend...

Initializing provider plugins...
- Reusing previous version of hashicorp/tfe from the dependency lock file
- Installing hashicorp/tfe v0.52.0...
- Installed hashicorp/tfe v0.52.0 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # tfe_organization.org will be created
  + resource "tfe_organization" "org" {
      + aggregated_commit_status_enabled                        = (known after apply)
      + allow_force_delete_workspaces                           = false
      + collaborator_auth_policy                                = "password"
      + cost_estimation_enabled                                 = (known after apply)
      + default_project_id                                      = (known after apply)
      + email                                                   = "e.e.f.prudhomme@gmail.com"
      + id                                                      = (known after apply)
      + name                                                    = "polymtl-cr460"
      + send_passing_statuses_for_untriggered_speculative_plans = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take
exactly these actions if you run "terraform apply" now.

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # tfe_organization.org will be created
  + resource "tfe_organization" "org" {
      + aggregated_commit_status_enabled                        = (known after apply)
      + allow_force_delete_workspaces                           = false
      + collaborator_auth_policy                                = "password"
      + cost_estimation_enabled                                 = (known after apply)
      + default_project_id                                      = (known after apply)
      + email                                                   = "e.e.f.prudhomme@gmail.com"
      + id                                                      = (known after apply)
      + name                                                    = "polymtl-cr460"
      + send_passing_statuses_for_untriggered_speculative_plans = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

tfe_organization.org: Creating...
tfe_organization.org: Creation complete after 1s [id=polymtl-cr460]

```
</details>


> ‚ö†Ô∏è **Note¬†:** Confirmer en entrant `yes`.

> üí° **Explications**¬†: Terraform cr√©e une organisation dans Terraform Cloud en utilisant la configuration donn√©e.

### Cr√©ation d‚Äôun nouveau projet Terraform Cloud
Pour cr√©er un nouvelle organisation ajouter ces blocs au fichier [terraform-cloud/project.tf](./terraform-cloud/project.tf).

```terraform
# Variable declaration with default values
variable "project_name" {
  type        = string
  description = "Terraform project."
  default     = "cr460-de01"
}

# Create a new terraform cloud project
resource "tfe_project" "project" {
  organization = tfe_organization.org.name
  name         = var.project_name
}
```

Ex√©cuter localement¬†:

```bash
REPO_NAME=cr460-de01
cd ~/$REPO_NAME/terraform-cloud/
terraform init
terraform plan
terraform apply
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution des commandes <code>terraform</code>¬†:</summary>

```console
Initializing the backend...

Initializing provider plugins...
- Reusing previous version of hashicorp/tfe from the dependency lock file
- Using previously-installed hashicorp/tfe v0.52.0

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
tfe_organization.org: Refreshing state... [id=polymtl-cr460]

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # tfe_project.project will be created
  + resource "tfe_project" "project" {
      + id           = (known after apply)
      + name         = "cr460-de01"
      + organization = "polymtl-cr460"
    }

Plan: 1 to add, 0 to change, 0 to destroy.

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take
exactly these actions if you run "terraform apply" now.
tfe_organization.org: Refreshing state... [id=polymtl-cr460]

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # tfe_project.project will be created
  + resource "tfe_project" "project" {
      + id           = (known after apply)
      + name         = "cr460-de01"
      + organization = "polymtl-cr460"
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

tfe_project.project: Creating...
tfe_project.project: Creation complete after 0s [id=prj-wmnphnD1QWmaxip6]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
```
</details>

> ‚ö†Ô∏è **Note¬†:** Confirmer en entrant `yes`.

> üí° **Explications**¬†: Terraform cr√©e un projet dans Terraform Cloud dans l‚Äôorganisation sp√©cifi√©e.

### Cr√©ation d‚Äôun espace de travail Terraform (_workspace_)
Pour cr√©er un nouvelle organisation ajouter ces blocs au fichier [terraform-cloud/project.tf](./terraform-cloud/project.tf).

```terraform
# Variable declaration with default values
variable "workspace_name" {
  type        = string
  description = "Terraform project name."
  default     = "cr460-de01-dev"
}

variable "workspace_tags" {
  # Tags should be in the form ["tag1", "tag2", ...]
  type        = list(string)
  description = "Terraform project tags."
  default     = ["polymtl", "dev"]
}

resource "tfe_workspace" "workspace" {
  # The project the workspace will be member of
  project_id   = tfe_project.project.id
  name         = var.workspace_name
  organization = tfe_organization.org.name
  tag_names    = var.workspace_tags
}
```

Ex√©cuter localement¬†:

```bash
REPO_NAME=cr460-de01
cd ~/$REPO_NAME/terraform-cloud/
terraform init
terraform plan
terraform apply
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution des commandes <code>terraform</code>¬†:</summary>

```console
Initializing the backend...

Initializing provider plugins...
- Reusing previous version of hashicorp/tfe from the dependency lock file
- Using previously-installed hashicorp/tfe v0.52.0

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.
tfe_organization.org: Refreshing state... [id=polymtl-cr460]
tfe_project.project: Refreshing state... [id=prj-wmnphnD1QWmaxip6]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # tfe_workspace.workspace will be created
  + resource "tfe_workspace" "workspace" {
      + agent_pool_id                 = (known after apply)
      + allow_destroy_plan            = true
      + auto_apply                    = false
      + auto_apply_run_trigger        = false
      + execution_mode                = (known after apply)
      + file_triggers_enabled         = true
      + force_delete                  = false
      + global_remote_state           = (known after apply)
      + html_url                      = (known after apply)
      + id                            = (known after apply)
      + name                          = "cr460-de01-dev"
      + operations                    = (known after apply)
      + organization                  = "polymtl-cr460"
      + project_id                    = "prj-wmnphnD1QWmaxip6"
      + queue_all_runs                = true
      + remote_state_consumer_ids     = (known after apply)
      + resource_count                = (known after apply)
      + speculative_enabled           = true
      + structured_run_output_enabled = true
      + tag_names                     = [
          + "dev",
          + "polymtl",
        ]
      + terraform_version             = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take exactlytfe_organization.org: Refreshing state... [id=polymtl-cr460]
tfe_project.project: Refreshing state... [id=prj-wmnphnD1QWmaxip6]

Terraform used the selected providers to generate the following execution plan. Resource actions are  + create

Terraform will perform the following actions:

  # tfe_workspace.workspace will be created
  + resource "tfe_workspace" "workspace" {
      + agent_pool_id                 = (known after apply)
      + allow_destroy_plan            = true
      + auto_apply                    = false
      + auto_apply_run_trigger        = false
      + execution_mode                = (known after apply)
      + file_triggers_enabled         = true
      + force_delete                  = false
      + global_remote_state           = (known after apply)
      + html_url                      = (known after apply)
      + id                            = (known after apply)
      + name                          = "cr460-de01-dev"
      + operations                    = (known after apply)
      + organization                  = "polymtl-cr460"
      + project_id                    = "prj-wmnphnD1QWmaxip6"
      + queue_all_runs                = true
      + remote_state_consumer_ids     = (known after apply)
      + resource_count                = (known after apply)
      + speculative_enabled           = true
      + structured_run_output_enabled = true
      + tag_names                     = [
          + "dev",
          + "polymtl",
        ]
      + terraform_version             = (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

tfe_workspace.workspace: Creating...
tfe_workspace.workspace: Creation complete after 0s [id=ws-55Pz9DZPACwiC5e8]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.
```
</details>

> ‚ö†Ô∏è **Note¬†:** Confirmer en entrant `yes`.

> üí° **Explications**¬†: Terraform cr√©e un espace de travail dans Terraform Cloud dans le projet sp√©cifi√©.

## Configuration du compte Microsoft Azure
### Installation de Azure CLI
> üìù **Note¬†:** Cette √©tape sera n√©cessaire pour la cr√©ation automatique d‚Äôun _service principal_.  Dans un soucis d‚Äôautomatiser le plus d‚Äô√©tape, utiliser cet utilitaire pourrait permettre la configuration des services d‚ÄôAzure ¬´¬†_as Code_¬†¬ª.

Pour n‚Äôinstaller qu‚ÄôAzure CLI, ex√©cuter localement la commande suivante¬†:

```bash
ansible-playbook --ask-become-pass -v playbook.yml --diff --tags azure-cli
```

<details>
  <summary>R√©sultats de l‚Äôex√©cution du playbook¬†:</summary>

```console
Using /etc/ansible/ansible.cfg as config file
BECOME password: XXXXXX
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Installation des logiciels du DE01 cours CR460] ******************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [localhost]

TASK [T√©l√©chargement de la clef PGP de Microsoft] **********************************************************************************************************************************************************
changed: [localhost] => {"after": ["EB3E94ADBE1229CF"], "before": [], "changed": true, "fp": "EB3E94ADBE1229CF", "id": "EB3E94ADBE1229CF", "key_id": "EB3E94ADBE1229CF", "short_id": "BE1229CF"}

TASK [Ajout du d√©p√¥t de Azure CLI] *************************************************************************************************************************************************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/ansible_microsoft_azure-cli.list
@@ -0,0 +1 @@
+deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_microsoft_archive-keyring.gpg] https://packages.microsoft.com/repos/azure-cli/ jammy main

changed: [localhost] => {"changed": true, "repo": "deb [arch=amd64 signed-by=/usr/share/keyrings/ansible_microsoft_archive-keyring.gpg] https://packages.microsoft.com/repos/azure-cli/ jammy main", "sources_added": ["/etc/apt/sources.list.d/ansible_microsoft_azure-cli.list"], "sources_removed": [], "state": "present"}

TASK [Installation de Azure CLI] ***************************************************************************************************************************************************************************
Lecture des listes de paquets‚Ä¶
Construction de l'arbre des d√©pendances‚Ä¶
Lecture des informations d'√©tat‚Ä¶
Les NOUVEAUX paquets suivants seront install√©s¬†:
  azure-cli
0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.
Il est n√©cessaire de prendre 0 o/55.4 Mo dans les archives.
Apr√®s cette op√©ration, 690 Mo d'espace disque suppl√©mentaires seront utilis√©s.
S√©lection du paquet azure-cli pr√©c√©demment d√©s√©lectionn√©.
(Lecture de la base de donn√©es... 
(Lecture de la base de donn√©es... 5%
(Lecture de la base de donn√©es... 10%
(Lecture de la base de donn√©es... 15%
(Lecture de la base de donn√©es... 20%
(Lecture de la base de donn√©es... 25%
(Lecture de la base de donn√©es... 30%
(Lecture de la base de donn√©es... 35%
(Lecture de la base de donn√©es... 40%
(Lecture de la base de donn√©es... 45%
(Lecture de la base de donn√©es... 50%
(Lecture de la base de donn√©es... 55%
(Lecture de la base de donn√©es... 60%
(Lecture de la base de donn√©es... 65%
(Lecture de la base de donn√©es... 70%
(Lecture de la base de donn√©es... 75%
(Lecture de la base de donn√©es... 80%
(Lecture de la base de donn√©es... 85%
(Lecture de la base de donn√©es... 90%
(Lecture de la base de donn√©es... 95%
(Lecture de la base de donn√©es... 100%
(Lecture de la base de donn√©es... 403828 fichiers et r√©pertoires d√©j√† install√©s.)
Pr√©paration du d√©paquetage de .../azure-cli_2.58.0-1~jammy_amd64.deb ...
D√©paquetage de azure-cli (2.58.0-1~jammy) ...
Param√©trage de azure-cli (2.58.0-1~jammy) ...
changed: [localhost] => {"cache_update_time": 1710052522, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Lecture des listes de paquets‚Ä¶\nConstruction de l'arbre des d√©pendances‚Ä¶\nLecture des informations d'√©tat‚Ä¶\nLes NOUVEAUX paquets suivants seront install√©s¬†:\n  azure-cli\n0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.\nIl est n√©cessaire de prendre 0 o/55.4 Mo dans les archives.\nApr√®s cette op√©ration, 690 Mo d'espace disque suppl√©mentaires seront utilis√©s.\nS√©lection du paquet azure-cli pr√©c√©demment d√©s√©lectionn√©.\r\n(Lecture de la base de donn√©es... \r(Lecture de la base de donn√©es... 5%\r(Lecture de la base de donn√©es... 10%\r(Lecture de la base de donn√©es... 15%\r(Lecture de la base de donn√©es... 20%\r(Lecture de la base de donn√©es... 25%\r(Lecture de la base de donn√©es... 30%\r(Lecture de la base de donn√©es... 35%\r(Lecture de la base de donn√©es... 40%\r(Lecture de la base de donn√©es... 45%\r(Lecture de la base de donn√©es... 50%\r(Lecture de la base de donn√©es... 55%\r(Lecture de la base de donn√©es... 60%\r(Lecture de la base de donn√©es... 65%\r(Lecture de la base de donn√©es... 70%\r(Lecture de la base de donn√©es... 75%\r(Lecture de la base de donn√©es... 80%\r(Lecture de la base de donn√©es... 85%\r(Lecture de la base de donn√©es... 90%\r(Lecture de la base de donn√©es... 95%\r(Lecture de la base de donn√©es... 100%\r(Lecture de la base de donn√©es... 403828 fichiers et r√©pertoires d√©j√† install√©s.)\r\nPr√©paration du d√©paquetage de .../azure-cli_2.58.0-1~jammy_amd64.deb ...\r\nD√©paquetage de azure-cli (2.58.0-1~jammy) ...\r\nParam√©trage de azure-cli (2.58.0-1~jammy) ...\r\n", "stdout_lines": ["Lecture des listes de paquets‚Ä¶", "Construction de l'arbre des d√©pendances‚Ä¶", "Lecture des informations d'√©tat‚Ä¶", "Les NOUVEAUX paquets suivants seront install√©s¬†:", "  azure-cli", "0 mis √† jour, 1 nouvellement install√©s, 0 √† enlever et 1 non mis √† jour.", "Il est n√©cessaire de prendre 0 o/55.4 Mo dans les archives.", "Apr√®s cette op√©ration, 690 Mo d'espace disque suppl√©mentaires seront utilis√©s.", "S√©lection du paquet azure-cli pr√©c√©demment d√©s√©lectionn√©.", "(Lecture de la base de donn√©es... ", "(Lecture de la base de donn√©es... 5%", "(Lecture de la base de donn√©es... 10%", "(Lecture de la base de donn√©es... 15%", "(Lecture de la base de donn√©es... 20%", "(Lecture de la base de donn√©es... 25%", "(Lecture de la base de donn√©es... 30%", "(Lecture de la base de donn√©es... 35%", "(Lecture de la base de donn√©es... 40%", "(Lecture de la base de donn√©es... 45%", "(Lecture de la base de donn√©es... 50%", "(Lecture de la base de donn√©es... 55%", "(Lecture de la base de donn√©es... 60%", "(Lecture de la base de donn√©es... 65%", "(Lecture de la base de donn√©es... 70%", "(Lecture de la base de donn√©es... 75%", "(Lecture de la base de donn√©es... 80%", "(Lecture de la base de donn√©es... 85%", "(Lecture de la base de donn√©es... 90%", "(Lecture de la base de donn√©es... 95%", "(Lecture de la base de donn√©es... 100%", "(Lecture de la base de donn√©es... 403828 fichiers et r√©pertoires d√©j√† install√©s.)", "Pr√©paration du d√©paquetage de .../azure-cli_2.58.0-1~jammy_amd64.deb ...", "D√©paquetage de azure-cli (2.58.0-1~jammy) ...", "Param√©trage de azure-cli (2.58.0-1~jammy) ..."]}

PLAY RECAP *************************************************************************************************************************************************************************************************
localhost                  : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```
</details>

> üí° **Explications**¬†: Le playbook t√©l√©charge premi√®rement la clef (PGP) du d√©p√¥t d‚ÄôAzure cli.  Le d√©p√¥t est aussi configur√©.  Finalement, le paquet `azure-cli` est install√©.

### Connexion au compte Azure (utilitaire `az`)
Lier le compte avec Azure CLI (`az`) en ex√©cutant localement¬†:

```bash
az login
```

L‚Äôutilitaire ouvrira une page du navigateur demandant de se connecter (ou choisir un compte connect√©).  Choisir le compte √† lier¬†:

![Connexion √† Azure avec az](./docs/az_login_page.png)

Lors d‚Äôune tentative de connexion r√©ussie, un message s‚Äôaffichera¬†:

![Connexion √† Azure avec az r√©ussie](./docs/az_login_success.png)

<details>
  <summary>R√©sultats de la commande <code>az login</code>¬†:</summary>

```console
A web browser has been opened at https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize. Please continue the login in the web browser. If no web browser is available or if the web browser fails to open, use device code flow with `az login --use-device-code`.
[
  {
    "cloudName": "AzureCloud",
    "homeTenantId": "HOME_TENANT_ID_HOME_TENANT_ID_HOME_T",
    "id": "ID_ID_ID_ID_ID_ID_ID_ID_ID_ID_ID_ID_",
    "isDefault": true,
    "managedByTenants": [],
    "name": "Azure subscription 1",
    "state": "Enabled",
    "tenantId": "TENANT_ID_TENANT_ID_TENANT_ID_TENANT",
    "user": {
      "name": "MAIL@MAIL.com",
      "type": "user"
    }
  }
]
```
</details>

> üí° **Explications**¬†: L‚Äôutilitaire az effectue enregistre des informations permettant de s‚Äôauthentifier aupr√®s d‚ÄôAzure.

### Cr√©ation du _service principal_
Afin de g√©rer l‚Äôacc√®s aux nouvelles ressources, nous devons cr√©er un [_service principal_](https://learn.microsoft.com/en-us/entra/identity-platform/app-objects-and-service-principals?tabs=browser).

Dans un shell de type _[POSIX](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html)_, ex√©cuter localement ceci¬†:

```bash
# Utiliser le premier abonnement disponible
subscription_id=$(az account list --query "[0].id" --output tsv)
# Cr√©ation d'un service principal
cat <(az ad sp create-for-rbac \
      --role="Contributor" \
      --scopes="/subscriptions/$subscription_id" \
      --name="git@github.com\:notetiene/cr460-de01.git") <(
    # Ajout de la propri√©t√©
    echo "{\"subscription_id\": \"$subscription_id\"}") |
    # Fusion des deux objets JSON
    jq -s '.[0] * .[1]' |
    # Mappage de propri√©t√©s Azure vers Terraform
    jq '. |= { client_id: .appId, client_secret: .password, tenant_id: .tenant, subscription_id}'
```

<details>
  <summary>R√©sultats de la commande¬†:</summary>

```json
{
  "client_id": "CLIENT_ID_CLIENT_ID_CLIENT_ID_CLIENT",
  "client_secret": "CLIENT_SECRET_CLIENT_SECRET_CLIENT_SECRE",
  "tenant_id": "TENANT_ID_TENANT_ID_TENANT_ID_TENANT",
  "subscription_id": "SUBSCRIPTION_ID_SUBSCRIPTION_ID_SUBS"
}
```
</details>

> üí° **Explications**¬†: La commande permet de cr√©er un nouveau service principal et de r√©cup√©rer des informations utile lors de l‚Äôarrimage de de Terraform et Azure.
